#!/bin/sh

setver=$(uname -r | tr -d \.)
servers=$(echo "rsync://mirror.leaseweb.com/openbsd
rsync://mirror.internode.on.net/openbsd
rsync://mirror.aarnet.edu.au/openbsd
rsync://ftp2.eu.openbsd.org/OpenBSD
rsync://openbsd.c3sl.ufpr.br/openbsd
rsync://openbsd.ipacct.com/OpenBSD
rsync://openbsd.cs.toronto.edu/openbsd
rsync://mirror.csclub.uwaterloo.ca/OpenBSD
rsync://mirror.one.com/openbsd
rsync://ftp.eenet.ee/OpenBSD
rsync://ftp.fr.openbsd.org/OpenBSD
rsync://mirrors.ircam.fr/pub/OpenBSD
rsync://ftp.spline.de/OpenBSD
rsync://ftp.halifax.rwth-aachen.de/openbsd
rsync://ftp.hostserver.de/OpenBSD
rsync://ftp.fau.de/openbsd
rsync://kartolo.sby.datautama.net.id/OpenBSD
rsync://ftp.heanet.ie/pub/OpenBSD
rsync://openbsd.mirror.garr.it/OpenBSD
rsync://ftp.jaist.ac.jp/pub/OpenBSD
rsync://ftp.kddilabs.jp/openbsd
rsync://ftp.riken.jp/openbsd
rsync://mirror.litnet.lt/OpenBSD
rsync://ftp.nluug.nl/openbsd
rsync://ftp.bit.nl/mirror/OpenBSD
rsync://mirrors.dalenys.com/OpenBSD
rsync://mirror.fsmg.org.nz/openbsd
rsync://ftp.piotrkosoft.net/OpenBSD
rsync://ftp.icm.edu.pl/pub/OpenBSD
rsync://ftp.rnl.tecnico.ulisboa.pt/pub/OpenBSD
rsync://mirrors.nav.ro/OpenBSD
rsync://mirrors.pidginhost.com/OpenBSD
rsync://ftp.eu.openbsd.org/OpenBSD
rsync://ftp.yzu.edu.tw/BSD/OpenBSD
rsync://rsync.mirrorservice.org/ftp.openbsd.org/pub/OpenBSD
rsync://anorien.csc.warwick.ac.uk/OpenBSD
rsync://mirror.bytemark.co.uk/OpenBSD
rsync://mirror.exonetric.net/OpenBSD
rsync://ftp3.usa.openbsd.org/ftp
rsync://mirrors.syringanetworks.net/OpenBSD
rsync://openbsd.mirror.constant.com/openbsd
rsync://ftp4.usa.openbsd.org/ftp
rsync://ftp5.usa.openbsd.org/ftp
rsync://mirror.esc7.net/openbsd" | sort -R | head -1)

rsync -avz --del --progress -f '. /home/user-name/Downloads/obsd-sets/filter.txt' "$servers"/snapshots/`arch -s`/ \
/home/user-name/Downloads/obsd-sets/upgrade && 


cd /home/user-name/Downloads/obsd-sets/upgrade ;
signify -V -e -p /etc/signify/openbsd-${setver}-base.pub -x  /home/user-name/Downloads/obsd-sets/upgrade/SHA256.sig -m - |
sha256 -C - $(ls |egrep -iv 'index|SHA256|install|oot|build|floppy|cd') ; cd -
